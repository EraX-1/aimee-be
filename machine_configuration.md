# オンプレマシン構成試算 (gemma3対応・RTX 4090推奨)

## 📋 目次
1. [最小構成 (約45万円)](#最小構成-約45万円)
2. [推奨構成 (約75万円)](#推奨構成-約75万円)
3. [高可用性構成 (約110万円)](#高可用性構成-約110万円)
4. [性能比較表](#性能比較表)
5. [Gemma3モデル選択ガイド](#gemma3モデル選択ガイド)
6. [コスト比較サマリー](#コスト比較サマリー)

---

## 最小構成 (約45万円)

### ハードウェア構成

| カテゴリ | 項目 | スペック | 価格 |
|---------|------|---------|------|
| **CPU** | AMD Ryzen 7 7700X | 8コア/16スレッド | ¥45,000 |
| **GPU** | NVIDIA RTX 4080 | 16GB VRAM | ¥180,000 |
| **マザーボード** | B650 | ATX | ¥20,000 |
| **メモリ** | DDR5-5600 64GB | 32GB×2枚 | ¥35,000 |
| **ストレージ (システム)** | NVMe SSD Gen4 | 500GB | ¥8,000 |
| **ストレージ (データ)** | NVMe SSD Gen4 | 2TB | ¥20,000 |
| **電源** | 1000W 80PLUS Gold | 1000W | ¥20,000 |
| **ケース** | ミドルタワー | エアフロー標準 | ¥12,000 |
| **CPUクーラー** | 空冷 (Noctua NH-D15等) | ハイエンド空冷 | ¥12,000 |
| **UPS** | CyberPower CP1500PFCLCD | 1500VA/900W | ¥35,000 |
| | | **合計** | **¥387,000** |

### ソフトウェア構成

| 項目 | 詳細 | 価格 |
|------|------|------|
| **OS** | Ubuntu 22.04 LTS Server | 無料 |
| **コンテナ** | Docker / Docker Compose | 無料 |
| **データベース** | MySQL 8.0 | 無料 |
| **キャッシュ** | Redis 7 | 無料 |
| **ベクトルDB** | ChromaDB | 無料 |
| **LLM (軽量)** | Ollama - qwen2:0.5b | 無料 |
| **LLM (メイン)** | Ollama - gemma3:4b / 12b | 無料 |

### 対応モデル & 性能指標

| モデル | gemma3:4b | gemma3:12b |
|--------|-----------|------------|
| **動作** | ◎ 余裕あり | △ ギリギリ |
| **VRAM使用率** | 50-60% | 90-95% |
| **同時推論数** | 6-8リクエスト | 3-4リクエスト |
| **レスポンス時間** | 1-2秒 | 2-3秒 |
| **推奨利用人数** | 10人 | 5-7人 |

### 総合評価

| 指標 | 値 |
|------|---|
| 安定性 | 中-高 |
| 将来性 | △ (12bは厳しい) |
| **推奨利用人数** | **5-10人** |
| **適用シーン** | **トライアル / 小規模運用** |

---

## 推奨構成 (約75万円)

### ハードウェア構成

| カテゴリ | 項目 | スペック | 価格 |
|---------|------|---------|------|
| **CPU** | AMD Ryzen 9 7900X | 12コア/24スレッド | ¥65,000 |
| **GPU** | NVIDIA RTX 4090 | 24GB VRAM | ¥300,000 |
| **マザーボード** | X670 | ATX | ¥30,000 |
| **メモリ** | DDR5-6000 128GB | 32GB×4枚 | ¥80,000 |
| **ストレージ (システム)** | NVMe SSD Gen4 | 1TB | ¥13,000 |
| **ストレージ (データ)** | NVMe SSD Gen4 | 4TB | ¥45,000 |
| **ストレージ (バックアップ)** | NVMe SSD 外付け | 4TB | ¥45,000 |
| **電源** | 1200W 80PLUS Platinum | 1200W | ¥30,000 |
| **ケース** | ミドルタワー | エアフロー重視 | ¥20,000 |
| **CPUクーラー** | 簡易水冷 | 280mm | ¥18,000 |
| **UPS** | APC Smart-UPS SMT1500J | 1500VA (管理機能付) | ¥80,000 |
| | | **合計** | **¥726,000** |

### ソフトウェア構成

| 項目 | 詳細 | 価格 |
|------|------|------|
| **OS** | Ubuntu 22.04 LTS Server | 無料 |
| **コンテナ** | Docker / Docker Compose | 無料 |
| **データベース** | MySQL 8.0 | 無料 |
| **キャッシュ** | Redis 7 | 無料 |
| **ベクトルDB** | ChromaDB | 無料 |
| **LLM (軽量)** | Ollama - qwen2:0.5b | 無料 |
| **LLM (メイン)** | Ollama - gemma3:4b / 12b / 27b | 無料 |
| **バックアップ** | 自動バックアップスクリプト | 無料 |

### 対応モデル & 性能指標

| モデル | gemma3:4b | gemma3:12b | gemma3:27b |
|--------|-----------|------------|------------|
| **動作** | ◎ 非常に余裕 | ◎ 余裕あり | ○ 動作可能 |
| **VRAM使用率** | 30-40% | 60-70% | 90-95% |
| **同時推論数** | 10-12リクエスト | 6-8リクエスト | 3-4リクエスト |
| **レスポンス時間** | 1秒以下 | 1-2秒 | 3-4秒 |
| **推奨利用人数** | 15人以上 | 10-12人 | 5-7人 |

### 総合評価

| 指標 | 値 |
|------|---|
| 安定性 | 高 |
| 将来性 | ◎ (全モデル対応) |
| **推奨利用人数** | **10人以上** |
| **適用シーン** | **本番運用 / 日常業務 / モデル選択の柔軟性** |

---

## 高可用性構成 (約110万円)

### ハードウェア構成

| カテゴリ | 項目 | スペック | 価格 |
|---------|------|---------|------|
| **CPU** | AMD Ryzen 9 7950X | 16コア/32スレッド | ¥90,000 |
| **GPU** | NVIDIA RTX 4090 | 24GB VRAM | ¥300,000 |
| **マザーボード** | X670E (ハイエンド) | ATX | ¥45,000 |
| **メモリ** | DDR5-6000 192GB | 32GB×6枚 | ¥120,000 |
| **ストレージ (システム)** | NVMe SSD Gen4 | 1TB | ¥13,000 |
| **ストレージ (データ)** | NVMe SSD Gen4 | 4TB | ¥45,000 |
| **ストレージ (バックアップ)** | NVMe SSD 外付け | 4TB | ¥45,000 |
| **NAS** | QNAP TS-464 + HDD 8TB×2 | 4ベイ RAID1 | ¥120,000 |
| **電源** | 1200W 80PLUS Platinum | 1200W | ¥30,000 |
| **ケース** | ミドルタワー | エアフロー最適化 | ¥25,000 |
| **CPUクーラー** | 簡易水冷 | 360mm | ¥25,000 |
| **UPS (メイン)** | APC Smart-UPS SMT1500J | 1500VA (管理機能付) | ¥80,000 |
| **UPS (冗長)** | CyberPower CP1500PFCLCD | 1500VA/900W (冗長化) | ¥35,000 |
| **10GbE NIC** | 10GbE ネットワークカード | オプション | ¥15,000 |
| **リモートKVM** | IP-KVMスイッチ | リモート管理用 | ¥25,000 |
| | | **合計** | **¥1,013,000** |

### ソフトウェア構成

| 項目 | 詳細 | 価格 |
|------|------|------|
| **OS** | Ubuntu 22.04 LTS Server | 無料 |
| **コンテナ** | Docker / Docker Compose | 無料 |
| **データベース** | MySQL 8.0 | 無料 |
| **キャッシュ** | Redis 7 | 無料 |
| **ベクトルDB** | ChromaDB | 無料 |
| **LLM (軽量)** | Ollama - qwen2:0.5b | 無料 |
| **LLM (メイン)** | Ollama - gemma3:4b / 12b / 27b | 無料 |
| **バックアップ** | 多層バックアップ (ローカル+NAS) | 無料 |
| **監視** | Prometheus + Grafana + Alertmanager | 無料 |

### 対応モデル & 性能指標

| モデル | gemma3:4b | gemma3:12b | gemma3:27b |
|--------|-----------|------------|------------|
| **動作** | ◎ 非常に余裕 | ◎ 非常に余裕 | ◎ 余裕あり |
| **VRAM使用率** | 30-40% | 60-70% | 85-90% |
| **同時推論数** | 12-15リクエスト | 8-10リクエスト | 4-6リクエスト |
| **レスポンス時間** | <1秒 | 1秒 | 2-3秒 |
| **推奨利用人数** | 20人以上 | 15人 | 10人 |

### 総合評価

| 指標 | 値 |
|------|---|
| 安定性 | 最高 |
| 将来性 | ◎ (全モデル対応 + 余裕) |
| **推奨利用人数** | **15人以上** |
| **適用シーン** | **ミッションクリティカル / 24時間運用 / 複数拠点** |

---

## 性能比較表

### 構成別総合比較

| 項目 | 最小構成 | 推奨構成 | 高可用性構成 |
|------|---------|---------|-------------|
| **総額** | ¥387,000 | ¥726,000 | ¥1,013,000 |
| **CPU** | Ryzen 7 7700X<br/>(8C/16T) | Ryzen 9 7900X<br/>(12C/24T) | Ryzen 9 7950X<br/>(16C/32T) |
| **GPU** | RTX 4080<br/>16GB | RTX 4090<br/>24GB | RTX 4090<br/>24GB |
| **メモリ** | 64GB | 128GB | 192GB |
| **ストレージ合計** | 2.5TB | 9TB | 9TB + NAS (16TB) |
| **UPS** | 1台 (900W) | 1台 (1500VA) 管理機能付 | 2台 (冗長化) |
| **gemma3:4b 対応** | ◎ | ◎ | ◎ |
| **gemma3:12b 対応** | △ ギリギリ | ◎ | ◎ |
| **gemma3:27b 対応** | ✕ 不可 | ○ 可能 | ◎ |
| **推奨利用人数** | 5-10人 | 10-15人 | 15人以上 |
| **安定性** | 中-高 | 高 | 最高 |
| **将来性** | △ | ◎ | ◎ |

### モデル別推論性能 (推奨構成 RTX 4090基準)

| モデル | モデルサイズ | VRAM使用 | 同時推論数 | レスポンス | 精度 | 推奨利用人数 |
|--------|------------|---------|-----------|-----------|------|------------|
| **gemma3:4b** | 3.3GB | 8GB (30-40%) | 10-12 | <1秒 | ⭐⭐⭐ | 15人以上 |
| **gemma3:12b** | 8.1GB | 16GB (60-70%) | 6-8 | 1-2秒 | ⭐⭐⭐⭐ | 10-12人 |
| **gemma3:27b** | 17GB | 24GB (85-90%) | 3-4 | 3-4秒 | ⭐⭐⭐⭐⭐ | 5-7人 |

### GPU別モデル対応表

| GPU | VRAM | gemma3:4b | gemma3:12b | gemma3:27b | 価格 | 推奨度 |
|-----|------|-----------|------------|------------|------|--------|
| RTX 4070 Ti | 12GB | ◎ | ✕ | ✕ | ¥120,000 | △ |
| RTX 4080 | 16GB | ◎ | △ | ✕ | ¥180,000 | ○ |
| **RTX 4090** | 24GB | ◎ | ◎ | ◎ | ¥300,000 | **◎** |

---

## Gemma3モデル選択ガイド

### モデル特性比較

| 特性 | gemma3:4b | gemma3:12b | gemma3:27b |
|------|-----------|------------|------------|
| **パラメータ数** | 4.3B | 12B | 27B |
| **モデルサイズ** | 3.3GB | 8.1GB | 17GB |
| **最小VRAM** | 8GB | 16GB | 24GB |
| **コンテキスト長** | 128K tokens | 128K tokens | 128K tokens |
| **マルチモーダル** | ○ (画像+テキスト) | ○ (画像+テキスト) | ○ (画像+テキスト) |
| **多言語対応** | 140言語以上 | 140言語以上 | 140言語以上 |
| **学習トークン数** | 4兆 | 12兆 | 14兆 |
| **推論速度** | 高速 | 中速 | 低速 |
| **精度** | 良好 | 高精度 | 最高精度 |

### 用途別推奨モデル

| 用途 | 推奨モデル | 理由 |
|------|----------|------|
| **リアルタイム対話** | gemma3:4b | 高速レスポンス、多数同時接続 |
| **複雑な分析・提案** | gemma3:12b | 精度とスピードのバランス |
| **高精度が必須** | gemma3:27b | 最高の精度、複雑な推論 |
| **画像分析が必要** | 12b または 27b | マルチモーダル性能が高い |
| **コスト重視** | gemma3:4b | GPU要件が低い |

### 段階的アップグレードパス

```
フェーズ1 (初期導入)
├─ gemma3:4b でスタート
├─ 運用フローの確立
└─ 精度要件の見極め (1-3ヶ月)

フェーズ2 (精度評価)
├─ gemma3:12b でテスト
├─ 精度向上の測定
└─ ユーザーフィードバック収集 (1ヶ月)

フェーズ3 (最適化)
├─ 要件に応じてモデル確定
│   ├─ 4b: 速度重視の場合
│   ├─ 12b: バランス重視の場合
│   └─ 27b: 精度重視の場合
└─ 本番運用開始
```

### モデル切り替え時の考慮事項

| 考慮事項 | 詳細 |
|---------|------|
| **ダウンロード時間** | 4b: 5分 / 12b: 10分 / 27b: 20分 |
| **初回起動時間** | 4b: 10秒 / 12b: 20秒 / 27b: 40秒 |
| **切り替え方法** | `.env`の`MAIN_MODEL`を変更後、Dockerコンテナ再起動 |
| **同時稼働** | 可能 (異なるポートで複数モデル並行運用) |

---

## コスト比較サマリー

### 構成別コスト内訳

| カテゴリ | 最小構成 | 推奨構成 | 高可用性構成 |
|---------|---------|---------|-------------|
| **CPU** | ¥45,000 | ¥65,000 | ¥90,000 |
| **GPU** | ¥180,000 | ¥300,000 | ¥300,000 |
| **マザーボード** | ¥20,000 | ¥30,000 | ¥45,000 |
| **メモリ** | ¥35,000 | ¥80,000 | ¥120,000 |
| **ストレージ** | ¥28,000 | ¥103,000 | ¥103,000 |
| **NAS** | - | - | ¥120,000 |
| **電源・冷却** | ¥32,000 | ¥48,000 | ¥55,000 |
| **ケース** | ¥12,000 | ¥20,000 | ¥25,000 |
| **UPS** | ¥35,000 | ¥80,000 | ¥115,000 |
| **ネットワーク機器** | - | - | ¥15,000 |
| **管理機器 (KVM)** | - | - | ¥25,000 |
| **合計** | **¥387,000** | **¥726,000** | **¥1,013,000** |

### 運用コスト試算 (月額)

| 項目 | 最小構成 | 推奨構成 | 高可用性構成 |
|------|---------|---------|-------------|
| **消費電力 (平均)** | 約450W | 約550W | 約650W |
| **消費電力 (ピーク)** | 約650W | 約850W | 約950W |
| **電気代 (24時間稼働)** | 約¥9,720/月 | 約¥11,880/月 | 約¥14,040/月 |
| **年間電気代** | 約¥116,640 | 約¥142,560 | 約¥168,480 |

※電気代単価 ¥30/kWh で計算

### モデル別運用コスト影響

| モデル | 消費電力増加 | 月額電気代増加 | 推論時間増加 |
|--------|------------|--------------|------------|
| **gemma3:4b** | ベースライン | - | - |
| **gemma3:12b** | +50W | +¥1,080/月 | +50% |
| **gemma3:27b** | +100W | +¥2,160/月 | +200% |

### 3年間総コスト (TCO)

| 構成 | 初期投資 | 3年間電気代 | 3年間TCO |
|------|---------|-----------|---------|
| **最小構成** | ¥387,000 | ¥350,000 | **¥737,000** |
| **推奨構成** | ¥726,000 | ¥428,000 | **¥1,154,000** |
| **高可用性構成** | ¥1,013,000 | ¥506,000 | **¥1,519,000** |

---

## 推奨事項

### ✅ 推奨構成 (RTX 4090 / ¥726,000) を選ぶべき理由

1. **全モデル対応**: gemma3 4b/12b/27b すべてに対応
2. **将来性**: 精度要件の変化に柔軟対応
3. **段階的運用**: 4bスタート → 必要に応じて12b/27bへ
4. **投資保護**: GPU交換なしでモデル切り替え可能
5. **10人同時利用**: 要件を満たす十分な性能

### 各構成の適用シーン

| 構成 | 価格 | 適用シーン |
|------|------|-----------|
| **最小構成** | 約39万円 | ・gemma3:4b専用運用<br/>・トライアル/PoC<br/>・5-10人小規模利用<br/>・予算制約あり |
| **推奨構成** | 約73万円 | ・全モデル対応<br/>・本番運用<br/>・10-15人中規模利用<br/>・将来の精度向上に備える |
| **高可用性構成** | 約101万円 | ・全モデル対応 + 冗長化<br/>・24時間運用<br/>・15人以上大規模利用<br/>・複数拠点統合 |

---

## 開発統合スケジュール

### フロントエンド・バックエンド統合タスク

| タスク | 作業内容 | 所要時間 |
|--------|---------|---------|
| **1. API接続実装** | Streamlit → FastAPI 接続<br/>認証機能追加 | 1-2日 |
| **2. データ連携** | CSV読込 → DB読込へ変更<br/>リアルタイム更新対応 | 1日 |
| **3. UI調整** | エラーハンドリング<br/>ローディング表示 | 0.5-1日 |
| **4. 精度向上** | プロンプト最適化<br/>RAG精度向上 | 2-3日 |
| **5. モデル評価** | 4b/12b/27b 比較テスト | 1日 |
| **6. テスト** | 統合テスト<br/>負荷テスト | 1日 |
| **合計** | | **6-9日** |

---

## まとめ

### 最適解: RTX 4090搭載の推奨構成 (約73万円)

| 項目 | 内容 |
|------|------|
| **初期投資** | ¥726,000 |
| **対応モデル** | gemma3:4b / 12b / 27b すべて対応 |
| **推奨利用人数** | 10-15人 |
| **開発期間** | 6-9日でフロントエンド・バックエンド統合 |
| **運用戦略** | 4bスタート → 精度要件に応じて12b/27bへ切替 |
| **月額コスト** | 約¥12,000 (電気代) |

### 次のステップ

1. **マシン調達**: 推奨構成 (RTX 4090) で調達開始
2. **並行開発**: フロントエンド・バックエンド統合 (6-9日)
3. **初期運用**: gemma3:4b で運用開始
4. **精度評価**: 1-2ヶ月後に12b/27bをテスト
5. **モデル確定**: 要件に最適なモデルで本番運用

**RTX 4090なら、追加投資なしで将来的に最高精度モデル (27b) まで対応可能です！**
